<!DOCTYPE html>
<html>
<head>
    <title>Debug Monaco Editor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #editor { width: 100%; height: 400px; border: 1px solid #ccc; }
        #status { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        #file-test { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Debug Monaco Editor</h1>
    
    <div id="status">Carregando...</div>
    
    <input type="file" id="fileInput" accept=".sysadl,.txt">
    <button id="testBtn">Testar Editor</button>
    
    <div id="editor"></div>
    
    <script>
        let editor = null;
        let monacoLoaded = false;
        
        // Log helper
        function log(msg) {
            console.log('[DEBUG]', msg);
            const status = document.getElementById('status');
            status.innerHTML += '<br>' + msg;
        }
        
        log('Iniciando debug...');
        
        // AMD require setup
        window.amdRequire = window.require;
        
        // Load Monaco
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js';
        script.onload = () => {
            log('Monaco loader carregado');
            
            const amdRequire = window.amdRequire || window.require;
            if (!amdRequire) {
                log('ERRO: AMD require não disponível');
                return;
            }
            
            amdRequire.config({ 
                paths: { 
                    'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' 
                } 
            });
            
            amdRequire(['vs/editor/editor.main'], () => {
                log('Monaco carregado com sucesso');
                monacoLoaded = true;
                
                try {
                    editor = monaco.editor.create(document.getElementById('editor'), {
                        value: 'model Test\nconfiguration {\n  component A a1;\n}',
                        language: 'plaintext',
                        theme: 'vs-dark',
                        automaticLayout: true,
                        fontSize: 14
                    });
                    
                    log('Editor criado com sucesso');
                } catch (e) {
                    log('ERRO ao criar editor: ' + e.message);
                }
            });
        };
        
        script.onerror = () => {
            log('ERRO: Falha ao carregar Monaco loader');
        };
        
        document.head.appendChild(script);
        
        // Test button
        document.getElementById('testBtn').addEventListener('click', () => {
            if (editor) {
                editor.setValue('model Updated\nconfiguration {\n  component B b1;\n}');
                log('Valor do editor atualizado');
            } else {
                log('Editor não disponível');
            }
        });
        
        // File input test
        document.getElementById('fileInput').addEventListener('change', async (ev) => {
            log('Arquivo selecionado');
            
            const f = ev.target.files && ev.target.files[0];
            if (!f) {
                log('Nenhum arquivo');
                return;
            }
            
            log('Arquivo: ' + f.name + ' (' + f.size + ' bytes)');
            
            try {
                const txt = await f.text();
                log('Conteúdo carregado: ' + txt.length + ' caracteres');
                
                if (editor) {
                    editor.setValue(txt);
                    log('Conteúdo definido no editor');
                } else {
                    log('Editor não disponível para definir conteúdo');
                }
            } catch (e) {
                log('ERRO ao ler arquivo: ' + e.message);
            }
        });
        
        // Check if APIs are available
        setTimeout(() => {
            log('Verificação de APIs:');
            log('- File API: ' + (!!window.File));
            log('- FileReader API: ' + (!!window.FileReader));
            log('- Monaco loaded: ' + monacoLoaded);
            log('- Editor created: ' + (!!editor));
        }, 2000);
    </script>
</body>
</html>